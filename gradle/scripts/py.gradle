def pythonCmd = "${rootDir}/venv/bin/python"
def pipCmd = "${pythonCmd} -m pip"
def yapfCmd = "${pythonCmd} -m yapf --style pep8 --recursive"

task pyDeps {
    doLast {
        exec {
            workingDir "${rootDir}"
            commandLine "sh", "-c", "${pipCmd} install -r requirements.txt && ${pipCmd} install -e ${rootDir}"
        }
    }
}

task pyCheck {
    doLast {
        exec {
            workingDir "${rootDir}"
            commandLine "sh", "-c", "${yapfCmd} -d ${projectDir}"
        }
    }
    dependsOn("${project.path}:pyDeps")
}

task pyFormat {
    doLast {
        exec {
            workingDir "${rootDir}"
            commandLine "sh", "-c", "${yapfCmd} -i ${projectDir}"
        }
    }
    dependsOn("${project.path}:pyDeps")
}
